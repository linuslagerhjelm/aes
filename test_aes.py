from unittest import TestCase
import AES

inp = b'linuslagerhjelm1'
key = b'secretkeybytes19'


class TestAES(TestCase):
    def test_sunny_day_encryption(self):
        expected = 'd17Mm4oZ1yfuIMPds6m0eDLYTQgauSnIy0t/ENKay7A='
        actual = AES.encrypt(inp, key)
        self.assertEqual(expected, actual)

    def test_nibbles(self):
        expected = (7, 3)
        actual = AES._nibbles(115)
        self.assertEqual(expected, actual)

    def test_sub_bytes(self):
        state = [
            [0x00, 0x3C, 0x6E, 0x47],
            [0x1F, 0x4E, 0x22, 0x74],
            [0x0E, 0x08, 0x1B, 0x31],
            [0x54, 0x59, 0x0B, 0x1A]
        ]
        expected = [
            [0x63, 0xEB, 0x9F, 0xA0],
            [0xC0, 0x2F, 0x93, 0x92],
            [0xAB, 0x30, 0xAF, 0xC7],
            [0x20, 0xCB, 0x2B, 0xA2],
        ]
        actual = AES._sub_bytes(state)
        self.assertEqual(expected, actual)

    def test_shift_rows(self):
        state = [
            [0x63, 0xEB, 0x9F, 0xA0],
            [0xC0, 0x2F, 0x93, 0x92],
            [0xAB, 0x30, 0xAF, 0xC7],
            [0x20, 0xCB, 0x2B, 0xA2],
        ]
        expected = [
            [0x63, 0xEB, 0x9F, 0xA0],
            [0x2F, 0x93, 0x92, 0xC0],
            [0xAF, 0xC7, 0xAB, 0x30],
            [0xA2, 0x20, 0xCB, 0x2B],
        ]
        actual = AES._shift_rows(state)
        self.assertEqual(expected, actual)

    def test_mix_column(self):
        state = [
            [0x63, 0xEB, 0x9F, 0xA0],
            [0x2F, 0x93, 0x92, 0xC0],
            [0xAF, 0xC7, 0xAB, 0x30],
            [0xA2, 0x20, 0xCB, 0x2B],
        ]
        expected = [
            [0xBA, 0x84, 0xE8, 0x1B],
            [0x75, 0xA4, 0x8D, 0x40],
            [0xF4, 0x8D, 0x06, 0x7D],
            [0x7A, 0x32, 0x0E, 0x5D],
        ]
        actual = AES._mix_columns(state)
        self.assertEqual(expected, actual)

    def test_add_roundkey(self):
        state = [
            [0x47, 0x40, 0xA3, 0x4C],
            [0x37, 0xD4, 0x70, 0x9F],
            [0x94, 0xE4, 0x3A, 0x42],
            [0xED, 0xA5, 0xA6, 0xBC]
        ]
        round_key = [
            [0xAC, 0x19, 0x28, 0x57],
            [0x77, 0xFA, 0xD1, 0x5C],
            [0x66, 0xDC, 0x29, 0x00],
            [0xED, 0xA5, 0xA6, 0xBC]
        ]

        expected = [
            [0xEB, 0x59, 0x8B, 0x1B],
            [0x40, 0x2E, 0xA1, 0xC3],
            [0xF2, 0x38, 0x13, 0x42],
            [0x1E, 0x84, 0xE7, 0xD2]
        ]
        actual = AES._add_roundkey(state, round_key)
        self.assertEqual(expected, actual)
